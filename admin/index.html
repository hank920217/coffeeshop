<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonlight CafÃ© å¾Œå°ç®¡ç†ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- å°è¦½åˆ— -->
    <nav class="navbar navbar-expand-lg sticky-top navbar-custom navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand"><span style="margin-right: 8px;">â˜•</span>Moonlight CafÃ© å¾Œå°</a>
        </div>
    </nav>

    <div class="container py-5">
        <!-- ç™»å…¥å€å¡Š -->
        <div id="login-section">
            <h2 class="login-title">æ­¡è¿å›åˆ° Moonlight CafÃ©</h2>
            <h5 class="login-subtitle">è«‹ç™»å…¥ä»¥é€²å…¥å¾Œå°ç®¡ç†ç³»çµ±</h5>

            <!-- ä½¿ç”¨ flex å±…ä¸­æŒ‰éˆ• -->
            <div class="d-flex justify-content-center">
                <button id="login-btn" class="btn btn-login-google">
                    <img src="./images/google.webp" alt="Google Logo">
                    <span>ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥</span>
                </button>
            </div>
        </div>

        <!-- ç®¡ç†å“¡å…§å®¹å€å¡Š -->
        <div id="admin-content" style="display: none;">
            <!-- æ­¡è¿è¨Šæ¯ Alert -->
            <div class="alert alert-success d-flex align-items-center mb-4" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                    class="bi bi-check-circle-fill me-2" viewBox="0 0 16 16">
                    <path
                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                </svg>
                <div>
                    æ­¡è¿å›ä¾†ï¼Œ<span id="admin-name" class="fw-bold"></span>ï¼æ‚¨å·²æˆåŠŸé€²å…¥ç³»çµ±ã€‚
                </div>
            </div>

            <!-- åŠŸèƒ½å¡ç‰‡å€ -->
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body text-center p-5">
                            <h5 class="card-title">ğŸ“¦ å•†å“ç®¡ç†</h5>
                            <p class="card-text mb-4">æ–°å¢ã€ä¿®æ”¹æˆ–ä¸‹æ¶å’–å•¡è±†èˆ‡é£²å“å“é …ã€‚</p>
                            <a href="product-management.html" class="btn btn-primary w-100">å‰å¾€ç®¡ç†</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body text-center p-5">
                            <h5 class="card-title">ğŸ“‹ è¨‚å–®ç›£æ§</h5>
                            <p class="card-text mb-4">å³æ™‚æŸ¥çœ‹é¡§å®¢è¨‚å–®ç‹€æ…‹èˆ‡è™•ç†é€²åº¦ã€‚</p>
                            <a href="order-monitor.html" class="btn btn-dark w-100">æŸ¥çœ‹è¨‚å–®</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // å¼•å…¥ Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

        import {
            getAuth,
            signInWithPopup,
            GoogleAuthProvider,
            onAuthStateChanged,
            signOut,
            setPersistence,
            browserSessionPersistence
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Firebase å°ˆæ¡ˆé…ç½®
        const firebaseConfig = {
            apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
            authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
            projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
            storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
            messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
            appId: import.meta.env.VITE_FIREBASE_APP_ID
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // è¨­å®šç®¡ç†å“¡ç™½åå–®
        const adminEmails = ["moonlightcafe.com@gmail.com"];

        const loginBtn = document.getElementById('login-btn');
        const loginSection = document.getElementById('login-section');
        const adminContent = document.getElementById('admin-content');
        const adminNameSpan = document.getElementById('admin-name');


        onAuthStateChanged(auth, (user) => {
            if (user) {
                // æª¢æŸ¥æ˜¯å¦åœ¨ç®¡ç†å“¡ç™½åå–®å…§
                if (adminEmails.includes(user.email)) {
                    console.log("é©—è­‰æˆåŠŸï¼Œæº–å‚™è·³è½‰...");
                    // æ›´æ–° UI
                    adminNameSpan.textContent = user.displayName;
                    // åŸæœ¬ç›´æ¥è·³è½‰ï¼Œç¾åœ¨ç‚ºäº†å±•ç¤ºæ•ˆæœï¼Œå…ˆé¡¯ç¤ºå…§å®¹ï¼ˆå¯¦éš›ä½¿ç”¨å¯æ ¹æ“šéœ€æ±‚èª¿æ•´ï¼‰
                    // ç‚ºäº†é¿å…ç¬é–“è·³è½‰çœ‹ä¸åˆ°æ–°æ¨£å¼ï¼Œé€™è£¡å¯ä»¥ç¨å¾®å»¶é²ï¼Œæˆ–è€…ç›´æ¥é¡¯ç¤º adminContent
                    // ä½†ä¾ç…§åŸé‚è¼¯æ˜¯ç›´æ¥è·³è½‰ï¼š
                    window.location.href = "order_page.html";

                } else {
                    // éç®¡ç†å“¡
                    alert("æ¬Šé™ä¸è¶³ï¼šæ‚¨çš„å¸³è™Ÿä¸¦éæˆæ¬Šå•†å®¶ã€‚");
                    signOut(auth);
                }
            } else {
                // æœªç™»å…¥ç‹€æ…‹
                loginSection.style.display = 'block';
                adminContent.style.display = 'none';
            }
        });

        // ç™»å…¥äº‹ä»¶
        loginBtn.onclick = async () => {
            try {
                await setPersistence(auth, browserSessionPersistence);
                await signInWithPopup(auth, provider);
                console.log("ç™»å…¥æˆåŠŸ");
            } catch (error) {
                console.error("ç™»å…¥éŒ¯èª¤ä»£ç¢¼:", error.code);
                console.error("éŒ¯èª¤è¨Šæ¯:", error.message);
                alert("ç™»å…¥å¤±æ•—");
            }
        };
    </script>
</body>

</html>